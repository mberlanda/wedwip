var addedGuests = <%= @guests.map{|g| {name: g.name, surname: g.surname} }.to_json.html_safe %>;

$(document).ready(function() {
  renderGuestsTable();
});

$("#add-guest").click(function() {
  var name = $("#guest_name").val(),
      surname = $("#guest_surname").val();
  
  if (name === "" || surname  === "") {
    return;
  }

  var item = {
    name: name,
    surname: surname
  };

  var found = false;
  $.each(addedGuests, function( index, value ) {
    if (value["name"] == name & value["surname"] == surname) {
      found = true;
    }
  });
  if (found) {
    return;
  }

  createGuest(item);
  addedGuests.push(item);

  renderGuestsTable();
})

function createGuest(item){

  console.log(item);
  $.ajax({
    beforeSend: function(xhr) {xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))},
    url: '<%= guests_path %>',
    dataType: 'json',
    type: "POST",
    quietMillis: 200,
    data: { guest_json: JSON.stringify(item)},
    })
   .done(data){
      console.log(data);
    }
  }


function renderGuestsTable() {
  var template = $.templates("#added-guests-template");
  var htmlAgreements = template.render(addedGuests);
  $("#added-guests-container").html(htmlAgreements);  
}

function removeGuest(index) {
  addedGuests.splice(index, 1);

  renderGuestsTable();
}